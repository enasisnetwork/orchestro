---
# Functions and routines associated with Enasis Network Orchestrations.

# This file is part of Enasis Network software eco-system. Distribution
# is permitted, for more information consult the project license file.






- name: Assert conditions for downstream tasks

  ansible.builtin.assert:
    that:

      - >-  # only specific hosts
        'roles_enrobie' in groups

  tags: always






- name: Declare relevant playbook variables

  ansible.legacy.set_fact:

    enrobie_vars: >-
      {%- set values = {} -%}
      {%- for key, value in vars.items() -%}
      {%-   if key.startswith('enrobie_') -%}
      {%-     do values.update({key: value}) -%}
      {%-   endif -%}
      {%- endfor -%}
      {{- values | sort_dict -}}

  tags: always



- name: Validate role variables using Pydantic

  enrobie_validate:
    params: '{{ enrobie_vars }}'

  register: enrobie_params

  tags: always



- name: Declare relevant playbook variables

  ansible.legacy.set_fact:

    enrobie_params: >-
      {%- set params = (
            enrobie_params.params
            .items()) -%}
      {%- set parsed = {} -%}
      {%- for key, value in params -%}
      {%-   do parsed.update({
              key[8:]: value}) -%}
      {%- endfor -%}
      {{- parsed | sort_dict -}}

  tags: always






- name: Include downstream tasks within roles

  ansible.builtin.include_tasks: >-
    tasks/overview.yml

  tags: overview
